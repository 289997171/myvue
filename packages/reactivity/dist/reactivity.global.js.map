{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/reactive.ts", "../src/computed.ts", "../src/watch.ts", "../src/ref.ts", "../src/toRef.ts"],
  "sourcesContent": ["export {reactive} from './reactive'\r\nexport {effect} from './effect'\r\nexport {computed} from './computed'\r\nexport {watch} from './watch'\r\nexport {ref} from './ref'\r\nexport {toRef, toRefs, proxyRefs} from './toRef'\r\n", "export const isObject = (val)=> {\r\n    return val !== null && typeof val === 'object'\r\n}\r\n\r\nexport const isFunction = (val)=> {\r\n    return typeof val === 'function'\r\n}\r\n\r\nexport const isString = (val)=> {\r\n    return typeof val === 'string'\r\n\r\n}\r\nexport const isNumber = (val)=> {\r\n    return typeof val === 'number'\r\n}\r\n\r\nexport const isArray = Array.isArray\r\nexport const assign = Object.assign\r\n", "// \u5F53\u524D\u6B63\u5728\u8FDB\u884C\u6536\u96C6\u7684effect\r\n// \u5BFC\u51FA\u7684\u662F\u53D8\u91CF,\u76F8\u5F53\u4E0E\u6307\u9488,\u5E76\u4E0D\u662Fundefined\u503C!!!\r\nexport let collectingEffect = undefined;\r\n\r\n\r\n\r\nconst cleanupEffect = (reactiveEffect)=> {\r\n    // TODO \u89E3\u51B3\u5206\u652F\u6E32\u67D3,\u6536\u96C6\u5C5E\u6027\u4F9D\u65E7\u4FDD\u5B58\u4E0D\u5FC5\u8981\u7684\u5C5E\u6027\u95EE\u9898\r\n    // TODO \u5982\u591A\u5F53\u524D\u6267\u884C\u662F\u56E0\u4E3Atrigger,\u90A3\u4E48\u4F1A\u5BFC\u81F4\u6B7B\u5FAA\u73AF\r\n    /*\r\n     \u6B7B\u5FAA\u73AF\u539F\u56E0:\r\n     let set = new Set(['a])\r\n     set.forEach(item=> {\r\n        set.delete('a')\r\n        set.add('a')\r\n     })\r\n    */\r\n    for (let i = 0; i < reactiveEffect.deps.length; i++) {\r\n        reactiveEffect.deps[i].delete(reactiveEffect) // \u8FD9\u91CC\u5220\u9664\u540E,targetP_EFs \u5BF9\u5E94\u7684\u4E5F\u4F1A\u88AB\u5220\u9664\r\n    }\r\n    reactiveEffect.deps.length = 0;\r\n}\r\n\r\nclass ReactiveEffect {\r\n    // \u662F\u5426\u9700\u8981\u6536\u96C6\u5BF9\u5E94\u51FD\u6570\u4E2D\u7684\u54CD\u5E94\u5F0F\u53D8\u91CF,\u9ED8\u8BA4true:\u9700\u8981\u8FDB\u884C\u6536\u96C6\r\n    needCollect = true;\r\n    // \u7531\u4E8E\u53EF\u80FD\u5D4C\u5957effect\u7684\u60C5\u51B5,\u6211\u4EEC\u9700\u8981\u8BB0\u5F55\u5F53\u524Deffect\u7684\u7236effect,\u4ECE\u800C\u89E3\u51B3\u5D4C\u5957\u5E26\u6765activeEffect\u4E0D\u660E\u786E\u7684\u95EE\u9898!\r\n    // \u76F8\u5BF9\u4E8E\u5165\u6808\u51FA\u6808\u6027\u80FD\u66F4\u597D\r\n    parentEF = undefined;\r\n    // [ef1,ef2, ...]\r\n    deps = []\r\n\r\n    constructor(public fn /*\u4E00\u822C\u662F\u6E32\u67D3\u51FD\u6570\u6216\u5C5E\u6027\u8BA1\u7B97\u51FD\u6570*/, public scheduler) {\r\n    }\r\n\r\n    run() {\r\n        // \u5982\u679C\u4E0D\u9700\u8981\u6536\u96C6,\u76F4\u63A5\u6267\u884C\u5BF9\u5E94\u7684\u6E32\u67D3\u51FD\u6570\r\n        if (!this.needCollect) this.fn()\r\n        else {\r\n            // \u8FDB\u884C\u4F9D\u8D56\u6536\u96C6,\u6838\u5FC3\u5C31\u662F\u5C06\u5F53\u524D\u7684effect \u548C \u7A0D\u540E\u6E32\u67D3\u7684\u5C5E\u6027\u8FDB\u884C\u5173\u8054\r\n\r\n            try {\r\n                // \u8003\u8651effect\u5D4C\u5957\u60C5\u51B5\u4E0B,\u5F53\u524Deffect\u6539\u53D8\u5168\u5C40activeEffect\u4E4B\u524D,\u8BB0\u5F55\u7236effect\r\n                this.parentEF = collectingEffect;\r\n\r\n                // \u5F53\u524Deffect\u7B2C\u4E00\u6B21run\u7684\u65F6\u5019,\u5C06\u5176\u4FDD\u5B58\u5230\u5168\u5C40\u53D8\u91CF\u4E2D\r\n                collectingEffect = this;\r\n\r\n                // \u6E05\u7A7A\u4E4B\u524Dobject \u5C5E\u6027 \u5BF9\u5F53\u524Deffect\u7684\u89E6\u53D1,\u4EE5\u8FBE\u5230\u6BD4\u5982\u5206\u652F\u6761\u4EF6\u6E32\u67D3\u5220\u9664\u4E0D\u518D\u4F9D\u8D56\u7684\u5C5E\u6027\r\n                cleanupEffect(this)\r\n\r\n                // \u6267\u884C\u5BF9\u5E94\u7684\u6E32\u67D3\u51FD\u6570,\u8BE5\u6E32\u67D3\u51FD\u6570\u6267\u884C\u65F6\u5C31\u80FD\u83B7\u5F97\u5168\u5C40\u7684activeEffect\r\n                // \u90A3\u4E48\u6E32\u67D3\u51FD\u6570\u4E2D\u7684\u54CD\u5E94\u5F0F\u53D8\u91CFProxy\u5728\u6267\u884Cget\u7684\u65F6\u5019\u4E5F\u80FD\u83B7\u5F97\u5168\u5C40\u7684activeEffect,\u4ECE\u800C\u5C06\u54CD\u5E94\u5F0F\u53D8\u91CF\u4E0Eeffect\u8FDB\u884C\u5173\u8054\r\n                return this.fn();\r\n            } finally {\r\n                collectingEffect = this.parentEF;\r\n                this.parentEF = null;\r\n\r\n\r\n                // TODO \u7531\u4E8E\u89E3\u51B3\u5D4C\u5957\u6267\u884C\u4F9D\u8D56 collectingEffect,\u800CcollectingEffect\u4F9D\u8D56\u5C5E\u6027\u6536\u96C6,\u6545\u8FD9\u91CC\u4E0D\u80FD\u53D6\u6D88\u5C5E\u6027\u6536\u96C6!\r\n                // TODO \u7531\u4E8E\u6761\u4EF6\u6E32\u67D3,\u5982\u679Ceffect\u53EA\u5728\u7B2C\u4E00\u6B21\u6267\u884C\u7684\u65F6\u5019\u6536\u96C6\u4F9D\u8D56,\u4E5F\u4E0D\u80FD\u8FBE\u5230\u6548\u679C,\u6545\u8FD9\u91CC\u4E0D\u80FD\u53D6\u6D88\u5C5E\u6027\u6536\u96C6!\r\n                // this.needCollect = false;\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    stop() {\r\n        if (this.needCollect) {\r\n            // \u505C\u6B62\u6536\u96C6\r\n            this.needCollect = false;\r\n            // \u6E05\u7A7A\u4E4B\u524Dobject \u5C5E\u6027 \u5BF9\u5F53\u524Deffect\u7684\u89E6\u53D1\r\n            cleanupEffect(this)\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * effect\u9ED8\u8BA4\u6267\u884C\u4E00\u6B21\r\n * effect\u6838\u5FC3\u903B\u8F91\u662F\u6536\u96C6\u51FD\u6570\u4E2D\u7684\u54CD\u5E94\u5F0F\u53D8\u91CF,\r\n * \u6BCF\u5F53\u6536\u96C6\u7684\u54CD\u5E94\u5F0F\u53D8\u91CF\u6539\u53D8,\u89E6\u53D1effect\u5BF9\u5E94\u7684\u51FD\u6570\u91CD\u65B0\u6267\u884C\r\n * @param renderFn \u6E32\u67D3\u51FD\u6570\r\n */\r\nconst effect = (renderFn, options: any = {}) => {\r\n\r\n    const re = new ReactiveEffect(renderFn, options.scheduler)\r\n\r\n    // \u9ED8\u8BA4\u6267\u884C\u4E00\u6B21\r\n    re.run()\r\n\r\n    // \u8FD4\u56DEReactiveEffect.run\u51FD\u6570 (run \u9700\u8981 \u7ED1\u5B9A this\u4E3A re)\r\n    const runner = re.run.bind(re);\r\n    runner.effect = re;\r\n    return runner\r\n}\r\n\r\n/**\r\n * \u6536\u96C6\u5BF9\u8C61\u7684\u90A3\u4E9B\u5C5E\u6027\u5BFC\u81F4\u90A3\u4E9Beffect\u6267\u884C!!!\r\n * \u5BF9\u8C61 -> \u5C5E\u6027 -> effect\r\n * k: \u539F\u59CB\u5BF9\u8C61\r\n * v: Map\r\n *      k: \u539F\u59CB\u5BF9\u8C61\u7684\u5C5E\u6027\u540D\u79F0\r\n *      v: Set \u4FDD\u5B58effect,\u5C31\u662F\u8BE5\u5C5E\u6027\u53EF\u80FD\u5BFC\u81F4\u90A3\u4E9Beffect\u6E32\u67D3\u51FD\u6570\u91CD\u65B0\u6E32\u67D3\r\n *      {obj, {p: [ef1, ef2, ...]}}\r\n */\r\nconst targetP_EFs = new WeakMap();\r\n/**\r\n * Proxy\u6267\u884C\u7684\u6536\u96C6\u51FD\u6570\r\n * @param target \u539F\u59CB\u5BF9\u8C61\r\n * @param type get/set \u4E00\u822C\u662FProxy:get\r\n * @param p \u539F\u59CB\u5BF9\u8C61\u7684\u5C5E\u6027\r\n */\r\nconst track = (target, type, p) => {\r\n    if (!collectingEffect) {\r\n        //console.warn('\u5F53\u524D\u6CA1\u6709\u6B63\u5728\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\u7684effect, \u8FD9\u79CD\u60C5\u51B5\u5B58\u5728\u4E8E\u6E32\u67D3\u51FD\u6570\u5728\u975Eeffect\u4E2D\u6267\u884C')\r\n        return;\r\n    }\r\n\r\n    let depsMap = targetP_EFs.get(target)\r\n    if (!depsMap) {\r\n        // k:\u5C5E\u6027\u540D v:Set\r\n        targetP_EFs.set(target, depsMap = new Map())\r\n    }\r\n\r\n    let dep = depsMap.get(p)\r\n    if (!dep) {\r\n        depsMap.set(p, dep = new Set())\r\n    }\r\n\r\n    trackDep(dep)\r\n\r\n    // \u6253\u5370\u5BF9\u8C61\u88AB\u6536\u96C6\u5230\u7684\u5C5E\u6027\r\n    //console.log('depsMap', depsMap)\r\n}\r\n\r\nconst trackDep = (dep)=> {\r\n    if (!collectingEffect) return;\r\n    if (!dep.has(collectingEffect)) {\r\n        //console.log('track...', p)\r\n        // \u53CC\u5411\u5173\u8054,\u591A\u5BF9\u591A\r\n        dep.add(collectingEffect) // \u6CE8\u610FcollectingEffect\u4E4B\u540E\u6539\u53D8\u4E0D\u4F1A\u5F71\u54CDdep\u91CC\u9762\u7684\u503C!!!\r\n        collectingEffect.deps.push(dep) // \u8BA9effect\u8BB0\u5F55\u5BF9\u5E94\u7684dep,\u5728\u4E4B\u540E\u6E05\u7406\u7684\u65F6\u5019\u4F1A\u7528\u5230\r\n    }\r\n}\r\n\r\n\r\n/*\r\n\u9700\u8981\u8003\u8651\u5D4C\u5957\u60C5\u51B5,\u4F9D\u8D56parentEF\r\n\r\neffect(()=> {\r\n    xxx.xxx\r\n    effect(()=> {\r\n        yyy.yyy\r\n    })\r\n\r\n    effect(()=> {\r\n        yyy.yyy\r\n    })\r\n})\r\n\r\n\r\n\u9700\u8981\u8003\u8651effect\u5220\u9664\u4F9D\u8D56\u7684\u60C5\u51B5\r\n\u5F53flag\u6539\u53D8,\u5BF9\u5E94proxy\u6536\u96C6\u7684\u5C5E\u6027\u4E5F\u6539\u53D8\u4E86\r\neffect(()=> {\r\n    flag ? proxy.xxx : proxy.yyy\r\n})\r\n*/\r\n\r\n\r\nconst trigger = (target, type, p, newValue, oldValue) => {\r\n    const pEFs = targetP_EFs.get(target)\r\n    if (!pEFs) return; // \u89E6\u53D1\u7684\u503C,\u6CA1\u6709\u5BF9\u5E94\u7684effects\r\n\r\n    const efs = pEFs.get(p)\r\n    if (efs) {\r\n        triggerEffects(efs)\r\n    }\r\n}\r\n\r\nconst triggerEffects = (efs)=> {\r\n    //console.log('trigger...', p)\r\n    // \u62F7\u8D1Defs\u8FDB\u884C\u904D\u5386,\r\n    // \u65B0\u7684_efs\u53EF\u80FD\u89E6\u53D1\u5220\u9664\r\n    // \u8001\u7684 efs\u53EF\u80FD\u8FDB\u884C\u6DFB\u52A0\r\n    const _efs = new Set<ReactiveEffect>(efs)\r\n    _efs.forEach(effect => {\r\n\r\n        // \u8003\u8651\u5D4C\u5957\u5FAA\u73AF,\u6267\u884Ceffect.run\u53EF\u80FD\u662Feffect\u672C\u8EAB\r\n        /*\r\n            \u53C2\u89C1: test71.html\r\n            effect(()=> {\r\n                console.log('effect...')\r\n\r\n                // TODO effect\u4E2D\u4FEE\u6539\u6536\u5230\u7684\u7684\u5C5E\u6027\u503C,\u5C06\u5BFC\u81F4\u5D4C\u5957\u5FAA\u73AF!!!\r\n                // set \u5BFC\u81F4 effect\r\n                // effect \u5BFC\u81F4 set\r\n                // ...\u5D4C\u5957\u5FAA\u73AF\r\n                state.age++\r\n\r\n                document.getElementById('app').innerHTML = `${state.name} \u4ECA\u5E74 ${state.age} \u5C81`\r\n            })\r\n        */\r\n        if (effect === collectingEffect) console.warn('effect\u4E2D\u4FEE\u6539\u6536\u5230\u7684\u7684\u5C5E\u6027\u503C,\u5FFD\u7565\u89E6\u53D1,\u76F4\u63A5\u5728\u5F53\u524D\u6E32\u67D3\u51FD\u6570\u5C31\u80FD\u751F\u6548!')\r\n        else {\r\n            if (effect.scheduler) {\r\n                console.log('trigger\u5BFC\u81F4effect\u6267\u884C::effect\u914D\u7F6E\u4E86\u8C03\u5EA6\u5668,\u6267\u884C\u8C03\u5EA6\u5668')\r\n                effect.scheduler()\r\n            } else {\r\n                console.log('trigger\u5BFC\u81F4effect\u6267\u884C::\u6267\u884C\u9ED8\u8BA4run')\r\n                effect.run()\r\n            }\r\n\r\n        }\r\n    })\r\n}\r\n\r\n\r\nexport {effect, track, trackDep, trigger, triggerEffects, ReactiveEffect}\r\n", "import {isObject} from \"@vue/shared\";\r\n\r\n// \u83B7\u5F97\u5F53\u524D\u6B63\u5728\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\u7684effect\r\nimport {track, trigger} from './effect'\r\n\r\nconst enum ReactiveFlag {\r\n    IS_REACTIVE = '__v_isReactive'\r\n}\r\n\r\n// \u4FDD\u5B58\u4EE5\u53CA\u539F\u59CB\u5BF9\u8C61\u4E0E\u4EE3\u7406\u5BF9\u8C61\u9690\u5C04\r\nconst reactiveMap = new WeakMap() // key\u53EA\u80FD\u662F\u5BF9\u8C61,\u5982\u679Ckey\u6307\u5411\u7684\u5BF9\u8C61\u540E\u9762\u8D4B\u503C\u4E3Anull,\u90A3\u4E48WeakMap\u4F1A\u81EA\u52A8\u5220\u9664,\u5783\u573E\u56DE\u6536\u76F8\u5173\r\n\r\n/**\r\n * \u5C06js\u539F\u59CB\u5BF9\u8C61,\u4F9D\u8D56Proxy\u8F6C\u6362\u6210\u54CD\u5E94\u5F0F\u6570\u636E\r\n * 1.reactive\u53EA\u652F\u6301\u5BF9\u8C61\u7684\u8F6C\u6362\r\n * @param target\r\n */\r\nconst reactive = (target)=> {\r\n    // 1.reactive\u53EA\u652F\u6301\u5BF9\u8C61\u7684\u8F6C\u6362\r\n    if (!isObject(target)) {\r\n        console.error('reactive\u53EA\u652F\u6301\u5BF9\u8C61\u7684\u8F6C\u6362:', target)\r\n        return\r\n    }\r\n\r\n    // \u5982\u679Ctarget\u662F\u4E00\u4E2A\u4EE3\u7406\u5BF9\u8C61Proxy,\u76F4\u63A5\u8FD4\u56DE\r\n    if (target[ReactiveFlag.IS_REACTIVE]) return target;\r\n\r\n    // \u5224\u65AD\u539F\u59CB\u5BF9\u8C61\u662F\u5426\u5DF2\u7ECF\u521B\u5EFA\u8FC7\u5BF9\u5E94\u7684\u4EE3\u7406\u5BF9\u8C61\r\n    let proxy = reactiveMap.get(target)\r\n    if (proxy)  return proxy;\r\n\r\n    proxy = new Proxy(target, {\r\n        get(target: any, p: string | symbol, receiver: any): any {\r\n            //return target[p]\r\n            // \u4E3A\u4EE3\u7406\u5BF9\u8C61\u6DFB\u52A0\u6807\u5FD7\r\n            if (p === ReactiveFlag.IS_REACTIVE) return true\r\n\r\n            // \u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\r\n            track(target, 'get', p)\r\n\r\n            let result = Reflect.get(target, p, receiver)\r\n            if (isObject(result)) {\r\n                return reactive(result) // \u5B9E\u73B0\u6DF1\u5C42\u4EE3\u7406,\u800C\u4E14\u6DF1\u5C42\u4EE3\u7406\u662F\u5F53\u6DF1\u5C42\u5BF9\u8C61\u6709\u53D6\u503C\u64CD\u4F5C\u7684\u65F6\u5019\u624D\u521B\u5EFA\u5BF9\u5E94\u7684\u4EE3\u7406\u5BF9\u8C61,\u6027\u80FD\u66F4\u597D!\r\n            }\r\n\r\n            return result;\r\n        },\r\n        set(target: any, p: string | symbol, value: any, receiver: any): boolean {\r\n            // target[p] = value;\r\n            // return true;\r\n\r\n            let result = false;\r\n\r\n            const oldValue = target[p]\r\n            if (oldValue !== value) { // \u6570\u636E\u53D8\u5316\u624D\u66F4\u65B0\r\n                result = Reflect.set(target, p, value, receiver)\r\n\r\n                // \u89E6\u53D1\u5C5E\u6027\u5BFC\u81F4effect\u6E32\u67D3\r\n                trigger(target, 'set', p, value, oldValue)\r\n            }\r\n\r\n            return result;\r\n        }\r\n    })\r\n\r\n    // \u5C06\u539F\u59CB\u5BF9\u8C61\u4E0E\u4EE3\u7406\u5BF9\u8C61\u5EFA\u7ACB\u9690\u5C04\r\n    reactiveMap.set(target, proxy)\r\n    return proxy\r\n}\r\n\r\nconst isReactive = (target)=> {\r\n    return !!(target && target[ReactiveFlag.IS_REACTIVE])\r\n}\r\n\r\nexport {reactive, isReactive}\r\n", "/**\r\n * options\u53EF\u4EE5\u662F\u4E00\u4E2A\u51FD\u6570|\u5BF9\u8C61{get, set}\r\n * @param options\r\n */\r\nimport {ReactiveEffect, trackDep, triggerEffects} from \"./effect\";\r\n\r\nclass ComputedRefImpl {\r\n    _value;\r\n    effect;\r\n    _dirty = true;\r\n    __v_isReadonly = true;\r\n    __v_isRef = true;\r\n    dep = new Set();\r\n\r\n    constructor(public getter, public setter) {\r\n        // \u5982\u679C\u6709setter\u5C31\u4E0D\u662F\u53EA\u8BFB\r\n        if (setter) this.__v_isReadonly = false\r\n\r\n        this.effect = new ReactiveEffect(getter, () => {\r\n            // \u76D1\u542C\u5230\u5C5E\u6027\u53D8\u5316\u4E86,\u89E6\u53D1\u8C03\u5EA6\u5668\r\n            if (!this._dirty) {\r\n                this._dirty = true\r\n                //trigger(this, 'set', 'value', null, null)\r\n                triggerEffects(this.dep)\r\n            }\r\n        })\r\n    }\r\n\r\n    // \u8C03\u7528computed\u8FD4\u56DE\u503C\u7684value,\u89E6\u53D1effect\u53BB\u8FDB\u884C\u5C5E\u6027\u6536\u96C6,\u5E76\u4E14\u83B7\u5F97\u7B2C\u4E00\u6B21\u6267\u884C\u65F6\u7684\u7ED3\u679C,\u8BBE\u7F6E\u7F13\u5B58\r\n    get value() {\r\n\r\n        // get\u7684\u65F6\u5019\u8FDB\u884C\u5C5E\u6027\u6536\u96C6\r\n        //track(this, 'get', 'value')\r\n        trackDep(this.dep)\r\n\r\n        if (this._dirty) {\r\n            this._dirty = false\r\n            this._value = this.effect.run()\r\n        }\r\n        return this._value\r\n    }\r\n\r\n    set value(newValue) {\r\n        if (this.setter) this.setter(newValue)\r\n    }\r\n}\r\n\r\nconst computed = (options) => {\r\n    return new ComputedRefImpl(options.get || options, options.set || undefined)\r\n}\r\n\r\nexport {computed}\r\n", "import {ReactiveEffect} from \"./effect\";\r\nimport {isReactive} from \"./reactive\";\r\nimport {isFunction, isObject} from \"@vue/shared\";\r\n\r\n\r\n/**\r\n * \u9012\u5F52\u4FBF\u5229\u5BF9\u8C61\r\n * @param target\r\n * @param set\r\n */\r\nconst traversal = (target, set = new Set()) =>{\r\n    if (!isObject(target)) return target\r\n\r\n    if (set.has(target)) return target\r\n\r\n    set.add(target)\r\n    for (let p in target) {\r\n        traversal(target[p], set)\r\n    }\r\n\r\n    return target\r\n}\r\n\r\nconst watch = (target, cb) => {\r\n\r\n    let getter;\r\n    if (isReactive(target)) {\r\n        getter = ()=> {\r\n            // \u9700\u8981\u9012\u5F52\u904D\u5386\u5BF9\u8C61\u5C5E\u6027,\u90A3\u4E48\u5C5E\u6027\u5C06\u88AB\u4F9D\u8D56\u6536\u96C6\r\n            return traversal(target);\r\n        }\r\n    } else if (isFunction(target)){\r\n        getter = target\r\n    } else {\r\n        console.error('watch\u9700\u8981\u54CD\u5E94\u5F0F\u5BF9\u8C61|getter\u51FD\u6570')\r\n        return\r\n    }\r\n\r\n    let cleanupHandle;\r\n    const onCleanup = (_cleanupHandle)=> {\r\n        cleanupHandle = _cleanupHandle\r\n    }\r\n\r\n    let oldValue;\r\n    const job = ()=> {\r\n        if (cleanupHandle) cleanupHandle() // \u4E0B\u4E00\u6B21watch\u5F00\u59CB\u89E6\u53D1\u4E0A\u8863\u6B21watch\u7684cleanup\r\n\r\n        const newValue = effect.run()\r\n        cb(newValue, oldValue, onCleanup)\r\n        oldValue = newValue;\r\n    }\r\n\r\n    const effect = new ReactiveEffect(getter, job)\r\n    oldValue = effect.run()\r\n}\r\n\r\nexport {watch}\r\n", "import {isObject} from \"@vue/shared\";\r\nimport {reactive} from \"./reactive\";\r\nimport {trackDep, triggerEffects} from \"./effect\";\r\n\r\nclass RefImpl {\r\n\r\n    _value;\r\n    dep = new Set();\r\n    __v_isRef = true;\r\n    constructor(public rawValue) {\r\n        this._value = toReactive(rawValue)\r\n    }\r\n\r\n    get value() {\r\n        // \u6536\u96C6\r\n        trackDep(this.dep)\r\n\r\n        return this._value\r\n    }\r\n\r\n    set value(val) {\r\n        if (this.rawValue !== val) {\r\n            this.rawValue = val;\r\n            this._value = toReactive(val)\r\n\r\n            // \u89E6\u53D1\r\n            triggerEffects(this.dep)\r\n        }\r\n    }\r\n}\r\n\r\nconst toReactive = (val)=> {\r\n    // \u5982\u679C\u662F\u5BF9\u8C61\r\n    return isObject(val) ? reactive(val) : val\r\n}\r\n\r\nconst ref = (val)=> {\r\n    return new RefImpl(val)\r\n}\r\n\r\nexport {ref}\r\n", "import {isReactive} from \"./reactive\";\r\nimport {isArray} from \"@vue/shared\";\r\n\r\n\r\nclass ObjectRefImpl {\r\n    __v_isRef = true;\r\n    _defaultValue = undefined;\r\n\r\n    constructor(public _object, public _key) {\r\n    }\r\n\r\n    get value() {\r\n        return this._object[this._key]\r\n    }\r\n\r\n    set value(val) {\r\n        this._object[this._key] = val;\r\n    }\r\n}\r\n\r\nconst toRef = (target, p) => {\r\n    return new ObjectRefImpl(target, p)\r\n}\r\n\r\nconst toRefs = (proxy) => {\r\n    if (!isReactive(proxy)) {\r\n        console.error('toRefs \u53C2\u6570\u9700\u8981\u662Freactive')\r\n        return\r\n    }\r\n    const result = isArray(proxy) ? new Array(proxy.length) : {}\r\n    for (let p in proxy) {\r\n        result[p] = toRef(proxy, p)\r\n    }\r\n\r\n    return result\r\n}\r\n\r\nconst proxyRefs = (target)=> {\r\n    return new Proxy(target,{\r\n        get(target: any, p: string | symbol, receiver: any): any {\r\n            let result = Reflect.get(target, p, receiver)\r\n            return result.__v_isRef ? result.value : result;\r\n        },\r\n        set(target: any, p: string | symbol, newValue: any, receiver: any): boolean {\r\n            const oldValue = target[p]\r\n            if (oldValue.__v_isRef) {\r\n                oldValue.value = newValue\r\n                return true;\r\n            } else {\r\n                return Reflect.set(target, p, newValue, receiver)\r\n            }\r\n        }\r\n    })\r\n}\r\n\r\nexport {toRef, toRefs, proxyRefs}\r\n"],
  "mappings": "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",
  "names": ["effect", "target", "effect", "target"]
}
